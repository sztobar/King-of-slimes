using Kite;
using System;
using UnityEngine;

public class PlayerVulnerability : MonoBehaviour, IPlayerUnitComponent
{

  public FlashSprite flashSprite;

  private BasePlayerActionAbility action;
  private HorizontalFlipComponent flip;
  private bool isShield;

  public bool IsVulnerable() => !isShield && !flashSprite.IsFlashing;

  public void Inject(PlayerUnitDI di)
  {
    action = di.abilities.action;
    flip = di.flip;
    isShield = di.stats.SlimeType == SlimeType.Shield;
  }

  public void SetInvulnerable() => flashSprite.StartFlash();
  public void SetInvulnerable(float duration)
  {
    flashSprite.StartFlash(duration);
  }

  internal bool IsGuarding => action.IsGuarding;

  internal bool IsGuardingInOpposingDirection(Direction2H direction) =>
    IsGuarding && flip.Direction != direction;
}